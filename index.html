<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;借據簽署器&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>body { font-family: sans-serif; padding: 20px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>input, canvas, button { display: block; margin: 10px 0; width: 100%; max-width: 400px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>canvas { border: 1px solid #ccc; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>#download-link { display: none; margin-top: 20px; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;h1&gt;借據簽署器&lt;/h1&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- 客服填寫區 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;section&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h3&gt;客服填寫：金額資訊&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="amount_text" placeholder="借款金額（中文，例如：伍萬元整）"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="amount_number" placeholder="借款金額（數字，例如：NT$50000）"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="generate-staff-pdf"&gt;產出 PDF 並傳給客戶&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- 客戶簽署區 --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;section&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h3&gt;客戶簽署&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="file" id="uploaded-pdf" accept="application/pdf"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="name" placeholder="姓名"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="idnumber" placeholder="身分證號碼"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="address" placeholder="住址"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="date" id="date"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;label&gt;簽名：&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;canvas id="signature-pad" width="300" height="100"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="clear"&gt;清除簽名&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="generate-client-pdf"&gt;產出最終 PDF 並回傳&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;a id="download-link"&gt;📥 下載 PDF&lt;/a&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>// 客服生成 PDF</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('generate-staff-pdf').onclick = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const text = document.getElementById('amount_text').value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const number = document.getElementById('amount_number').value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!text || !number) return alert('請輸入完整金額');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const pdfDoc = await PDFLib.PDFDocument.create();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const page = pdfDoc.addPage([595, 842]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText('借據', { x: 260, y: 780, size: 18, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`一、茲借款金額新台幣：${text}`, { x: 50, y: 720, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`一、茲借款金額新台幣：${number}`, { x: 50, y: 700, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`二、該款項當已親收足訖無訛。`, { x: 50, y: 680, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`三、到期借款人即將借款本金及利息以及應付之一切款項一併清償絕不拖延。`, { x: 50, y: 660, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`四、保證人願負連帶清償責任及拋棄先訴抗辯權。`, { x: 50, y: 640, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`五、本人明確知悉本借款為雙方合意訂定，並非急迫輕率無經驗，或受到任何暴。`, { x: 50, y: 620, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`六、唯恐說無憑 特立此書`, { x: 50, y: 600, size: 12, font });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const pdfBytes = await pdfDoc.save();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const blob = new Blob([pdfBytes], { type: 'application/pdf' });</p>
<p class="p1"><span class="Apple-converted-space">      </span>const urlBlob = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const link = document.getElementById("download-link");</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.href = urlBlob;</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.download = `借據_客服填寫.pdf`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.innerText = '📥 下載給客戶用 PDF';</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const signaturePad = new SignaturePad(document.getElementById("signature-pad"));</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById("clear").onclick = () =&gt; signaturePad.clear();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 客戶簽署後嵌入 PDF</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById("generate-client-pdf").onclick = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const file = document.getElementById('uploaded-pdf').files[0];</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!file || signaturePad.isEmpty()) return alert('請上傳 PDF 並完成簽名');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const name = document.getElementById('name').value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const id = document.getElementById('idnumber').value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const address = document.getElementById('address').value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const date = document.getElementById('date').value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!name || !id || !address || !date) return alert('請填寫所有欄位');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const arrayBuffer = await file.arrayBuffer();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const page = pdfDoc.getPages()[0];</p>
<p class="p1"><span class="Apple-converted-space">      </span>const pngImage = await pdfDoc.embedPng(signaturePad.toDataURL());</p>
<p class="p1"><span class="Apple-converted-space">      </span>const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`姓名：${name}`, { x: 50, y: 350, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`身分證號碼：${id}`, { x: 50, y: 330, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`住址：${address}`, { x: 50, y: 310, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawText(`日期：${date}`, { x: 50, y: 290, size: 12, font });</p>
<p class="p1"><span class="Apple-converted-space">      </span>page.drawImage(pngImage, { x: 300, y: 320, width: 150, height: 50 });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const pdfBytes = await pdfDoc.save();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const blob = new Blob([pdfBytes], { type: 'application/pdf' });</p>
<p class="p1"><span class="Apple-converted-space">      </span>const urlBlob = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const link = document.getElementById("download-link");</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.href = urlBlob;</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.download = `借據_已簽署.pdf`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.innerText = '📥 下載簽署完成檔案後傳回 LINE';</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
