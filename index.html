<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å€Ÿæ“šç°½ç½²å™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, canvas, button { display: block; margin: 10px 0; width: 100%; max-width: 400px; }
    canvas { border: 1px solid #ccc; }
    #download-link { display: none; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>å€Ÿæ“šç°½ç½²å™¨</h1>

  <!-- å®¢æœå¡«å¯«å€ -->
  <section>
    <h3>å®¢æœå¡«å¯«ï¼šé‡‘é¡è³‡è¨Š</h3>
    <input type="text" id="amount_text" placeholder="å€Ÿæ¬¾é‡‘é¡ï¼ˆä¸­æ–‡ï¼Œä¾‹å¦‚ï¼šä¼è¬å…ƒæ•´ï¼‰">
    <input type="text" id="amount_number" placeholder="å€Ÿæ¬¾é‡‘é¡ï¼ˆæ•¸å­—ï¼Œä¾‹å¦‚ï¼šNT$50000ï¼‰">
    <button id="generate-staff-pdf">ç”¢å‡º PDF ä¸¦å‚³çµ¦å®¢æˆ¶</button>
  </section>

  <!-- å®¢æˆ¶ç°½ç½²å€ -->
  <section>
    <h3>å®¢æˆ¶ç°½ç½²</h3>
    <input type="file" id="uploaded-pdf" accept="application/pdf">
    <input type="text" id="name" placeholder="å§“å">
    <input type="text" id="idnumber" placeholder="èº«åˆ†è­‰è™Ÿç¢¼">
    <input type="text" id="address" placeholder="ä½å€">
    <input type="date" id="date">
    <label>ç°½åï¼š</label>
    <canvas id="signature-pad" width="300" height="100"></canvas>
    <button id="clear">æ¸…é™¤ç°½å</button>
    <button id="generate-client-pdf">ç”¢å‡ºæœ€çµ‚ PDF ä¸¦å›å‚³</button>
  </section>

  <a id="download-link">ğŸ“¥ ä¸‹è¼‰ PDF</a>

  <script>
    // å®¢æœç”Ÿæˆ PDF
    document.getElementById('generate-staff-pdf').onclick = async () => {
      const text = document.getElementById('amount_text').value;
      const number = document.getElementById('amount_number').value;
      if (!text || !number) return alert('è«‹è¼¸å…¥å®Œæ•´é‡‘é¡');

      const pdfDoc = await PDFLib.PDFDocument.create();
      const page = pdfDoc.addPage([595, 842]);
      const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);

      page.drawText('å€Ÿæ“š', { x: 260, y: 780, size: 18, font });
      page.drawText(`ä¸€ã€èŒ²å€Ÿæ¬¾é‡‘é¡æ–°å°å¹£ï¼š${text}`, { x: 50, y: 720, size: 12, font });
      page.drawText(`ä¸€ã€èŒ²å€Ÿæ¬¾é‡‘é¡æ–°å°å¹£ï¼š${number}`, { x: 50, y: 700, size: 12, font });
      page.drawText(`äºŒã€è©²æ¬¾é …ç•¶å·²è¦ªæ”¶è¶³è¨–ç„¡è¨›ã€‚`, { x: 50, y: 680, size: 12, font });
      page.drawText(`ä¸‰ã€åˆ°æœŸå€Ÿæ¬¾äººå³å°‡å€Ÿæ¬¾æœ¬é‡‘åŠåˆ©æ¯ä»¥åŠæ‡‰ä»˜ä¹‹ä¸€åˆ‡æ¬¾é …ä¸€ä½µæ¸…å„Ÿçµ•ä¸æ‹–å»¶ã€‚`, { x: 50, y: 660, size: 12, font });
      page.drawText(`å››ã€ä¿è­‰äººé¡˜è² é€£å¸¶æ¸…å„Ÿè²¬ä»»åŠæ‹‹æ£„å…ˆè¨´æŠ—è¾¯æ¬Šã€‚`, { x: 50, y: 640, size: 12, font });
      page.drawText(`äº”ã€æœ¬äººæ˜ç¢ºçŸ¥æ‚‰æœ¬å€Ÿæ¬¾ç‚ºé›™æ–¹åˆæ„è¨‚å®šï¼Œä¸¦éæ€¥è¿«è¼•ç‡ç„¡ç¶“é©—ï¼Œæˆ–å—åˆ°ä»»ä½•æš´ã€‚`, { x: 50, y: 620, size: 12, font });
      page.drawText(`å…­ã€å”¯æèªªç„¡æ†‘ ç‰¹ç«‹æ­¤æ›¸`, { x: 50, y: 600, size: 12, font });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const urlBlob = URL.createObjectURL(blob);
      const link = document.getElementById("download-link");
      link.href = urlBlob;
      link.download = `å€Ÿæ“š_å®¢æœå¡«å¯«.pdf`;
      link.style.display = 'block';
      link.innerText = 'ğŸ“¥ ä¸‹è¼‰çµ¦å®¢æˆ¶ç”¨ PDF';
    };

    const signaturePad = new SignaturePad(document.getElementById("signature-pad"));
    document.getElementById("clear").onclick = () => signaturePad.clear();

    // å®¢æˆ¶ç°½ç½²å¾ŒåµŒå…¥ PDF
    document.getElementById("generate-client-pdf").onclick = async () => {
      const file = document.getElementById('uploaded-pdf').files[0];
      if (!file || signaturePad.isEmpty()) return alert('è«‹ä¸Šå‚³ PDF ä¸¦å®Œæˆç°½å');

      const name = document.getElementById('name').value;
      const id = document.getElementById('idnumber').value;
      const address = document.getElementById('address').value;
      const date = document.getElementById('date').value;
      if (!name || !id || !address || !date) return alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');

      const arrayBuffer = await file.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
      const page = pdfDoc.getPages()[0];
      const pngImage = await pdfDoc.embedPng(signaturePad.toDataURL());
      const font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);

      page.drawText(`å§“åï¼š${name}`, { x: 50, y: 350, size: 12, font });
      page.drawText(`èº«åˆ†è­‰è™Ÿç¢¼ï¼š${id}`, { x: 50, y: 330, size: 12, font });
      page.drawText(`ä½å€ï¼š${address}`, { x: 50, y: 310, size: 12, font });
      page.drawText(`æ—¥æœŸï¼š${date}`, { x: 50, y: 290, size: 12, font });
      page.drawImage(pngImage, { x: 300, y: 320, width: 150, height: 50 });

      const pdfBytes = await pdfDoc.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      const urlBlob = URL.createObjectURL(blob);
      const link = document.getElementById("download-link");
      link.href = urlBlob;
      link.download = `å€Ÿæ“š_å·²ç°½ç½².pdf`;
      link.style.display = 'block';
      link.innerText = 'ğŸ“¥ ä¸‹è¼‰ç°½ç½²å®Œæˆæª”æ¡ˆå¾Œå‚³å› LINE';
    };
  </script>
</body>
</html>
